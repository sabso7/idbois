{"version":3,"sources":["../../../src/components/VFileInput/VFileInput.tsx"],"names":["filterFieldProps","makeVFieldProps","VChip","VCounter","VField","useForwardRef","useLocale","useProxiedModel","computed","nextTick","ref","defineComponent","filterInputAttrs","humanReadableFileSize","useRender","wrapInArray","filterInputProps","makeVInputProps","VInput","VFileInput","name","inheritAttrs","props","chips","Boolean","counter","counterSizeString","type","String","default","counterString","multiple","hint","persistentHint","placeholder","persistentPlaceholder","showSize","Number","validator","v","includes","prependIcon","modelValue","Array","val","every","clearable","emits","e","files","setup","attrs","emit","slots","t","model","base","undefined","totalBytes","value","reduce","bytes","size","totalBytesReadable","fileNames","map","file","counterValue","fileCount","length","vInputRef","vFieldRef","isFocused","inputRef","isActive","messages","onFocus","document","activeElement","focus","onControlClick","click","onClear","stopPropagation","hasCounter","rootAttrs","inputAttrs","_","inputProps","fieldProps","isDisabled","isReadonly","class","fieldClass","slotProps","target","selection","text","color","join","details"],"mappings":"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","sourcesContent":["// Styles\nimport './VFileInput.sass'\n\n// Components\nimport { filterFieldProps, makeVFieldProps } from '@/components/VField/VField'\nimport { VChip } from '@/components/VChip'\nimport { VCounter } from '@/components/VCounter'\nimport { VField } from '@/components/VField'\n\n// Composables\nimport { useForwardRef } from '@/composables/forwardRef'\nimport { useLocale } from '@/composables/locale'\nimport { useProxiedModel } from '@/composables/proxiedModel'\n\n// Utilities\nimport { computed, nextTick, ref } from 'vue'\nimport { defineComponent, filterInputAttrs, humanReadableFileSize, useRender, wrapInArray } from '@/util'\n\n// Types\nimport type { PropType } from 'vue'\nimport { filterInputProps, makeVInputProps, VInput } from '@/components/VInput/VInput'\n\nexport const VFileInput = defineComponent({\n  name: 'VFileInput',\n\n  inheritAttrs: false,\n\n  props: {\n    chips: Boolean,\n    counter: Boolean,\n    counterSizeString: {\n      type: String,\n      default: '$vuetify.fileInput.counterSize',\n    },\n    counterString: {\n      type: String,\n      default: '$vuetify.fileInput.counter',\n    },\n    multiple: Boolean,\n    hint: String,\n    persistentHint: Boolean,\n    placeholder: String,\n    persistentPlaceholder: Boolean,\n    showSize: {\n      type: [Boolean, Number] as PropType<boolean | 1000 | 1024>,\n      default: false,\n      validator: (v: boolean | number) => {\n        return (\n          typeof v === 'boolean' ||\n          [1000, 1024].includes(v)\n        )\n      },\n    },\n\n    ...makeVInputProps(),\n\n    prependIcon: {\n      type: String,\n      default: '$file',\n    },\n    modelValue: {\n      type: Array as PropType<File[]>,\n      default: () => ([]),\n      validator: (val: any) => {\n        return wrapInArray(val).every(v => v != null && typeof v === 'object')\n      },\n    },\n\n    ...makeVFieldProps({ clearable: true }),\n  },\n\n  emits: {\n    'click:clear': (e: MouseEvent) => true,\n    'click:control': (e: MouseEvent) => true,\n    'update:modelValue': (files: File[]) => true,\n  },\n\n  setup (props, { attrs, emit, slots }) {\n    const { t } = useLocale()\n    const model = useProxiedModel(props, 'modelValue')\n    const base = computed(() => typeof props.showSize !== 'boolean' ? props.showSize : undefined)\n    const totalBytes = computed(() => (model.value ?? []).reduce((bytes, { size = 0 }) => bytes + size, 0))\n    const totalBytesReadable = computed(() => humanReadableFileSize(totalBytes.value, base.value))\n\n    const fileNames = computed(() => (model.value ?? []).map(file => {\n      const { name = '', size = 0 } = file\n\n      return !props.showSize\n        ? name\n        : `${name} (${humanReadableFileSize(size, base.value)})`\n    }))\n\n    const counterValue = computed(() => {\n      const fileCount = model.value?.length ?? 0\n      if (props.showSize) return t(props.counterSizeString, fileCount, totalBytesReadable.value)\n      else return t(props.counterString, fileCount)\n    })\n    const vInputRef = ref<VInput>()\n    const vFieldRef = ref<VInput>()\n    const isFocused = ref(false)\n    const inputRef = ref<HTMLInputElement>()\n    const isActive = computed(() => (\n      isFocused.value ||\n      props.persistentPlaceholder\n    ))\n    const messages = computed(() => {\n      return props.messages.length\n        ? props.messages\n        : (isActive.value || props.persistentHint) ? props.hint : ''\n    })\n    function onFocus () {\n      if (inputRef.value !== document.activeElement) {\n        inputRef.value?.focus()\n      }\n\n      if (!isFocused.value) {\n        isFocused.value = true\n      }\n    }\n    function onControlClick (e: MouseEvent) {\n      inputRef.value?.click()\n\n      emit('click:control', e)\n    }\n    function onClear (e: MouseEvent) {\n      e.stopPropagation()\n\n      onFocus()\n\n      nextTick(() => {\n        model.value = []\n\n        if (inputRef?.value) {\n          inputRef.value.value = ''\n        }\n\n        emit('click:clear', e)\n      })\n    }\n\n    useRender(() => {\n      const hasCounter = !!(slots.counter || props.counter || counterValue.value)\n      const [rootAttrs, inputAttrs] = filterInputAttrs(attrs)\n      const [{ modelValue: _, ...inputProps }] = filterInputProps(props)\n      const [fieldProps] = filterFieldProps(props)\n\n      return (\n        <VInput\n          ref={ vInputRef }\n          v-model={ model.value }\n          class=\"v-file-input\"\n          { ...rootAttrs }\n          { ...inputProps }\n          onClick:prepend={ onControlClick }\n          messages={ messages.value }\n        >\n          {{\n            ...slots,\n            default: ({\n              isDisabled,\n              isReadonly,\n            }) => (\n              <VField\n                ref={ vFieldRef }\n                focused={ isFocused.value }\n                prepend-icon={ props.prependIcon }\n                onClick:control={ onControlClick }\n                onClick:clear={ onClear }\n                { ...fieldProps }\n                modelValue={ model.value }\n              >\n                {{\n                  ...slots,\n                  default: ({\n                    props: { class: fieldClass, ...slotProps },\n                  }) => (\n                    <>\n                      <input\n                        ref={ inputRef }\n                        type=\"file\"\n                        readonly={ isReadonly.value }\n                        disabled={ isDisabled.value }\n                        multiple={ props.multiple }\n                        onClick={ e => {\n                          e.stopPropagation()\n\n                          onFocus()\n                        } }\n                        onChange={ e => {\n                          if (!e.target) return\n\n                          const target = e.target as HTMLInputElement\n                          model.value = [...target.files ?? []]\n                        } }\n                        onFocus={ onFocus }\n                        onBlur={ () => (isFocused.value = false) }\n                        { ...slotProps }\n                        { ...inputAttrs }\n                      />\n\n                      { model.value.length > 0 && (\n                        <div class={ fieldClass }>\n                          { slots.selection ? slots.selection({\n                            fileNames: fileNames.value,\n                            totalBytes: totalBytes.value,\n                            totalBytesReadable: totalBytesReadable.value,\n                          })\n                          : props.chips ? fileNames.value.map(text => (\n                            <VChip\n                              key={ text }\n                              size=\"small\"\n                              color={ props.color }\n                            >{ text }</VChip>\n                          ))\n                          : fileNames.value.join(', ') }\n                        </div>\n                      ) }\n                    </>\n                  ),\n                }}\n              </VField>\n            ),\n            details: hasCounter ? () => (\n              <>\n                <span />\n\n                <VCounter\n                  value={ counterValue.value }\n                  v-slots={ slots.counter }\n                />\n              </>\n            ) : undefined,\n          }}\n        </VInput>\n      )\n    })\n\n    return useForwardRef({}, vInputRef, vFieldRef, inputRef)\n  },\n})\n\nexport type VFileInput = InstanceType<typeof VFileInput>\n"],"file":"VFileInput.mjs"}